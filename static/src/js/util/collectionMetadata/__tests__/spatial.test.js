import { getCollectionGeoFeatures } from '../spatial'

describe('getCollectionGeoFeatures', () => {
  describe('when the collection metadata has multiple spatial features', () => {
    test('returns the collection of geo features based on the collection metadata', () => {
      const metadata = {
        boxes: [
          '-6.17041 -18.28125 32.62583 60'
        ],
        coordinateSystem: 'CARTESIAN',
        lines: [
          '-14.07 -0.37 1.27 4.75',
          '44.9778 -93.265 47.6062 -122.3321'
        ],
        points: null,
        gibsLayers: 'None',
        spatial: [
          'Bounding Rectangle: (32.62583°, -18.28125°, -6.17041°, 60.0°)\n',
          'Line: ((-14.07°, -0.37°), (1.27°, 4.75°))\n',
          'Line: ((44.9778°, -93.265°), (47.6062°, -122.3321°))\n'
        ]
      }
      const response = getCollectionGeoFeatures(metadata)
      expect(response).toEqual([
        {
          type: 'Feature',
          properties: {},
          geometry: {
            type: 'MultiPolygon',
            coordinates: [
              [
                [
                  [-18.28125, -6.17041],
                  [-15.8349609375, -6.17041],
                  [-13.388671875, -6.17041],
                  [-10.9423828125, -6.17041],
                  [-8.49609375, -6.17041],
                  [-6.0498046875, -6.17041],
                  [-3.603515625, -6.17041],
                  [-1.1572265625, -6.17041],
                  [1.2890625, -6.17041],
                  [3.7353515625, -6.17041],
                  [6.181640625, -6.17041],
                  [8.6279296875, -6.17041],
                  [11.07421875, -6.17041],
                  [13.5205078125, -6.17041],
                  [15.966796875, -6.17041],
                  [18.4130859375, -6.17041],
                  [20.859375, -6.17041],
                  [23.3056640625, -6.17041],
                  [25.751953125, -6.17041],
                  [28.1982421875, -6.17041],
                  [30.64453125, -6.17041],
                  [33.0908203125, -6.17041],
                  [35.537109375, -6.17041],
                  [37.9833984375, -6.17041],
                  [40.4296875, -6.17041],
                  [42.8759765625, -6.17041],
                  [45.322265625, -6.17041],
                  [47.7685546875, -6.17041],
                  [50.21484375, -6.17041],
                  [52.6611328125, -6.17041],
                  [55.107421875, -6.17041],
                  [57.5537109375, -6.17041],
                  [60, -6.17041],
                  [60, -3.7456450000000006],
                  [60, -1.3208800000000003],
                  [60, 1.1038849999999998],
                  [60, 3.52865],
                  [60, 5.953415],
                  [60, 8.37818],
                  [60, 10.802945000000001],
                  [60, 13.22771],
                  [60, 15.652474999999999],
                  [60, 18.07724],
                  [60, 20.502005],
                  [60, 22.92677],
                  [60, 25.351535],
                  [60, 27.7763],
                  [60, 30.201065],
                  [60, 32.62583],
                  [57.5537109375, 32.62583],
                  [55.107421875, 32.62583],
                  [52.6611328125, 32.62583],
                  [50.21484375, 32.62583],
                  [47.7685546875, 32.62583],
                  [45.322265625, 32.62583],
                  [42.8759765625, 32.62583],
                  [40.4296875, 32.62583],
                  [37.9833984375, 32.62583],
                  [35.537109375, 32.62583],
                  [33.0908203125, 32.62583],
                  [30.64453125, 32.62583],
                  [28.1982421875, 32.62583],
                  [25.751953125, 32.62583],
                  [23.3056640625, 32.62583],
                  [20.859375, 32.62583],
                  [18.4130859375, 32.62583],
                  [15.966796875, 32.62583],
                  [13.5205078125, 32.62583],
                  [11.07421875, 32.62583],
                  [8.6279296875, 32.62583],
                  [6.181640625, 32.62583],
                  [3.7353515625, 32.62583],
                  [1.2890625, 32.62583],
                  [-1.1572265625, 32.62583],
                  [-3.603515625, 32.62583],
                  [-6.0498046875, 32.62583],
                  [-8.49609375, 32.62583],
                  [-10.9423828125, 32.62583],
                  [-13.388671875, 32.62583],
                  [-15.8349609375, 32.62583],
                  [-18.28125, 32.62583],
                  [-18.28125, 30.201065],
                  [-18.28125, 27.7763],
                  [-18.28125, 25.351535],
                  [-18.28125, 22.92677],
                  [-18.28125, 20.502005],
                  [-18.28125, 18.07724],
                  [-18.28125, 15.652474999999999],
                  [-18.28125, 13.22771],
                  [-18.28125, 10.802945000000001],
                  [-18.28125, 8.37818],
                  [-18.28125, 5.953415],
                  [-18.28125, 3.52865],
                  [-18.28125, 1.1038849999999998],
                  [-18.28125, -1.3208800000000003],
                  [-18.28125, -3.7456450000000006],
                  [-18.28125, -6.17041]
                ]
              ]
            ]
          }
        },
        {
          type: 'Feature',
          properties: {},
          geometry: {
            type: 'MultiLineString',
            coordinates: [
              [[-0.37, -14.07], [4.75, 1.27]],
              [[-93.265, 44.9778], [-122.3321, 47.6062]]
            ]
          }
        }
      ])

      // Bounding box and a 2 lines
      expect(response.length).toEqual(2)
    })
  })

  describe('when the collection metadata has a single spatial feature', () => {
    describe('when the spatial feature is a bounding box', () => {
      test('returns normalized feature collection', () => {
        const metadata = {
          boxes: ['-56 -180 60 180'],
          coordinateSystem: 'CARTESIAN',
          lines: null,
          points: null,
          polygons: null,
          gibsLayers: 'None',
          spatial: null
        }
        const featureCollectionMock = [
          {
            type: 'Feature',
            properties: {},
            geometry: {
              type: 'MultiPolygon',
              coordinates: [
                [
                  [
                    [
                      -180,
                      -56
                    ],
                    [
                      -174.375,
                      -56
                    ],
                    [
                      -168.75,
                      -56
                    ],
                    [
                      -163.125,
                      -56
                    ],
                    [
                      -157.5,
                      -56
                    ],
                    [
                      -151.875,
                      -56
                    ],
                    [
                      -146.25,
                      -56
                    ],
                    [
                      -140.625,
                      -56
                    ],
                    [
                      -135,
                      -56
                    ],
                    [
                      -129.375,
                      -56
                    ],
                    [
                      -123.75,
                      -56
                    ],
                    [
                      -118.125,
                      -56
                    ],
                    [
                      -112.5,
                      -56
                    ],
                    [
                      -106.875,
                      -56
                    ],
                    [
                      -101.25,
                      -56
                    ],
                    [
                      -95.625,
                      -56
                    ],
                    [
                      -90,
                      -56
                    ],
                    [
                      -84.375,
                      -56
                    ],
                    [
                      -78.75,
                      -56
                    ],
                    [
                      -73.125,
                      -56
                    ],
                    [
                      -67.5,
                      -56
                    ],
                    [
                      -61.875,
                      -56
                    ],
                    [
                      -56.25,
                      -56
                    ],
                    [
                      -50.625,
                      -56
                    ],
                    [
                      -45,
                      -56
                    ],
                    [
                      -39.375,
                      -56
                    ],
                    [
                      -33.75,
                      -56
                    ],
                    [
                      -28.125,
                      -56
                    ],
                    [
                      -22.5,
                      -56
                    ],
                    [
                      -16.875,
                      -56
                    ],
                    [
                      -11.25,
                      -56
                    ],
                    [
                      -5.625,
                      -56
                    ],
                    [
                      0,
                      -56
                    ],
                    [
                      5.625,
                      -56
                    ],
                    [
                      11.25,
                      -56
                    ],
                    [
                      16.875,
                      -56
                    ],
                    [
                      22.5,
                      -56
                    ],
                    [
                      28.125,
                      -56
                    ],
                    [
                      33.75,
                      -56
                    ],
                    [
                      39.375,
                      -56
                    ],
                    [
                      45,
                      -56
                    ],
                    [
                      50.625,
                      -56
                    ],
                    [
                      56.25,
                      -56
                    ],
                    [
                      61.875,
                      -56
                    ],
                    [
                      67.5,
                      -56
                    ],
                    [
                      73.125,
                      -56
                    ],
                    [
                      78.75,
                      -56
                    ],
                    [
                      84.375,
                      -56
                    ],
                    [
                      90,
                      -56
                    ],
                    [
                      95.625,
                      -56
                    ],
                    [
                      101.25,
                      -56
                    ],
                    [
                      106.875,
                      -56
                    ],
                    [
                      112.5,
                      -56
                    ],
                    [
                      118.125,
                      -56
                    ],
                    [
                      123.75,
                      -56
                    ],
                    [
                      129.375,
                      -56
                    ],
                    [
                      135,
                      -56
                    ],
                    [
                      140.625,
                      -56
                    ],
                    [
                      146.25,
                      -56
                    ],
                    [
                      151.875,
                      -56
                    ],
                    [
                      157.5,
                      -56
                    ],
                    [
                      163.125,
                      -56
                    ],
                    [
                      168.75,
                      -56
                    ],
                    [
                      174.375,
                      -56
                    ],
                    [
                      180,
                      -56
                    ],
                    [
                      180,
                      -52.375
                    ],
                    [
                      180,
                      -48.75
                    ],
                    [
                      180,
                      -45.125
                    ],
                    [
                      180,
                      -41.5
                    ],
                    [
                      180,
                      -37.875
                    ],
                    [
                      180,
                      -34.25
                    ],
                    [
                      180,
                      -30.625
                    ],
                    [
                      180,
                      -27
                    ],
                    [
                      180,
                      -23.375
                    ],
                    [
                      180,
                      -19.75
                    ],
                    [
                      180,
                      -16.125
                    ],
                    [
                      180,
                      -12.5
                    ],
                    [
                      180,
                      -8.875
                    ],
                    [
                      180,
                      -5.25
                    ],
                    [
                      180,
                      -1.625
                    ],
                    [
                      180,
                      2
                    ],
                    [
                      180,
                      5.625
                    ],
                    [
                      180,
                      9.25
                    ],
                    [
                      180,
                      12.875
                    ],
                    [
                      180,
                      16.5
                    ],
                    [
                      180,
                      20.125
                    ],
                    [
                      180,
                      23.75
                    ],
                    [
                      180,
                      27.375
                    ],
                    [
                      180,
                      31
                    ],
                    [
                      180,
                      34.625
                    ],
                    [
                      180,
                      38.25
                    ],
                    [
                      180,
                      41.875
                    ],
                    [
                      180,
                      45.5
                    ],
                    [
                      180,
                      49.125
                    ],
                    [
                      180,
                      52.75
                    ],
                    [
                      180,
                      56.375
                    ],
                    [
                      180,
                      60
                    ],
                    [
                      174.375,
                      60
                    ],
                    [
                      168.75,
                      60
                    ],
                    [
                      163.125,
                      60
                    ],
                    [
                      157.5,
                      60
                    ],
                    [
                      151.875,
                      60
                    ],
                    [
                      146.25,
                      60
                    ],
                    [
                      140.625,
                      60
                    ],
                    [
                      135,
                      60
                    ],
                    [
                      129.375,
                      60
                    ],
                    [
                      123.75,
                      60
                    ],
                    [
                      118.125,
                      60
                    ],
                    [
                      112.5,
                      60
                    ],
                    [
                      106.875,
                      60
                    ],
                    [
                      101.25,
                      60
                    ],
                    [
                      95.625,
                      60
                    ],
                    [
                      90,
                      60
                    ],
                    [
                      84.375,
                      60
                    ],
                    [
                      78.75,
                      60
                    ],
                    [
                      73.125,
                      60
                    ],
                    [
                      67.5,
                      60
                    ],
                    [
                      61.875,
                      60
                    ],
                    [
                      56.25,
                      60
                    ],
                    [
                      50.625,
                      60
                    ],
                    [
                      45,
                      60
                    ],
                    [
                      39.375,
                      60
                    ],
                    [
                      33.75,
                      60
                    ],
                    [
                      28.125,
                      60
                    ],
                    [
                      22.5,
                      60
                    ],
                    [
                      16.875,
                      60
                    ],
                    [
                      11.25,
                      60
                    ],
                    [
                      5.625,
                      60
                    ],
                    [
                      0,
                      60
                    ],
                    [
                      -5.625,
                      60
                    ],
                    [
                      -11.25,
                      60
                    ],
                    [
                      -16.875,
                      60
                    ],
                    [
                      -22.5,
                      60
                    ],
                    [
                      -28.125,
                      60
                    ],
                    [
                      -33.75,
                      60
                    ],
                    [
                      -39.375,
                      60
                    ],
                    [
                      -45,
                      60
                    ],
                    [
                      -50.625,
                      60
                    ],
                    [
                      -56.25,
                      60
                    ],
                    [
                      -61.875,
                      60
                    ],
                    [
                      -67.5,
                      60
                    ],
                    [
                      -73.125,
                      60
                    ],
                    [
                      -78.75,
                      60
                    ],
                    [
                      -84.375,
                      60
                    ],
                    [
                      -90,
                      60
                    ],
                    [
                      -95.625,
                      60
                    ],
                    [
                      -101.25,
                      60
                    ],
                    [
                      -106.875,
                      60
                    ],
                    [
                      -112.5,
                      60
                    ],
                    [
                      -118.125,
                      60
                    ],
                    [
                      -123.75,
                      60
                    ],
                    [
                      -129.375,
                      60
                    ],
                    [
                      -135,
                      60
                    ],
                    [
                      -140.625,
                      60
                    ],
                    [
                      -146.25,
                      60
                    ],
                    [
                      -151.875,
                      60
                    ],
                    [
                      -157.5,
                      60
                    ],
                    [
                      -163.125,
                      60
                    ],
                    [
                      -168.75,
                      60
                    ],
                    [
                      -174.375,
                      60
                    ],
                    [
                      -180,
                      60
                    ],
                    [
                      -180,
                      56.375
                    ],
                    [
                      -180,
                      52.75
                    ],
                    [
                      -180,
                      49.125
                    ],
                    [
                      -180,
                      45.5
                    ],
                    [
                      -180,
                      41.875
                    ],
                    [
                      -180,
                      38.25
                    ],
                    [
                      -180,
                      34.625
                    ],
                    [
                      -180,
                      31
                    ],
                    [
                      -180,
                      27.375
                    ],
                    [
                      -180,
                      23.75
                    ],
                    [
                      -180,
                      20.125
                    ],
                    [
                      -180,
                      16.5
                    ],
                    [
                      -180,
                      12.875
                    ],
                    [
                      -180,
                      9.25
                    ],
                    [
                      -180,
                      5.625
                    ],
                    [
                      -180,
                      2
                    ],
                    [
                      -180,
                      -1.625
                    ],
                    [
                      -180,
                      -5.25
                    ],
                    [
                      -180,
                      -8.875
                    ],
                    [
                      -180,
                      -12.5
                    ],
                    [
                      -180,
                      -16.125
                    ],
                    [
                      -180,
                      -19.75
                    ],
                    [
                      -180,
                      -23.375
                    ],
                    [
                      -180,
                      -27
                    ],
                    [
                      -180,
                      -30.625
                    ],
                    [
                      -180,
                      -34.25
                    ],
                    [
                      -180,
                      -37.875
                    ],
                    [
                      -180,
                      -41.5
                    ],
                    [
                      -180,
                      -45.125
                    ],
                    [
                      -180,
                      -48.75
                    ],
                    [
                      -180,
                      -52.375
                    ],
                    [
                      -180,
                      -56
                    ]
                  ]
                ]
              ]
            }
          }
        ]

        expect(getCollectionGeoFeatures(metadata)).toEqual(featureCollectionMock)
      })
    })

    describe('when the spatial feature is a point', () => {
      test('returns normalized feature collection', () => {
        const metadata = {
          boxes: null,
          coordinateSystem: 'CARTESIAN',
          lines: null,
          points: ['39.1 -96.6'],
          polygons: null,
          gibsLayers: 'None',
          spatial: null
        }
        // Const responseObject
        expect(getCollectionGeoFeatures(metadata)).toEqual([{
          geometry: {
            coordinates: [[-96.6, 39.1]],
            type: 'MultiPoint'
          },
          properties: {},
          type: 'Feature'
        }])
      })
    })

    describe('when the spatial feature is a polygon', () => {
      test('returns normalized feature collection', () => {
        const metadata = {
          boxes: null,
          coordinateSystem: 'CARTESIAN',
          lines: null,
          points: null,
          polygons: [['25 -130 25 -100 45 -100 45 -130 25 -130']],
          gibsLayers: 'None',
          spatial: null
        }
        expect(getCollectionGeoFeatures(metadata)).toEqual([
          {
            type: 'Feature',
            properties: {},
            geometry: {
              type: 'MultiPolygon',
              coordinates: [
                [
                  [
                    [
                      -130,
                      25
                    ],
                    [
                      -128.13801291876314,
                      25.179213250446185
                    ],
                    [
                      -126.27090060346934,
                      25.335064125790144
                    ],
                    [
                      -124.39933865744398,
                      25.467326970558812
                    ],
                    [
                      -122.52402823567374,
                      25.575808821609424
                    ],
                    [
                      -120.6456922466102,
                      25.660350398518535
                    ],
                    [
                      -118.76507130963104,
                      25.720826933302423
                    ],
                    [
                      -116.88291951030847,
                      25.75714882810219
                    ],
                    [
                      -115.00000000000003,
                      25.769262131690493
                    ],
                    [
                      -113.11708048969157,
                      25.757148828102192
                    ],
                    [
                      -111.23492869036897,
                      25.720826933302423
                    ],
                    [
                      -109.3543077533898,
                      25.660350398518545
                    ],
                    [
                      -107.47597176432629,
                      25.575808821609424
                    ],
                    [
                      -105.60066134255604,
                      25.467326970558812
                    ],
                    [
                      -103.72909939653067,
                      25.335064125790144
                    ],
                    [
                      -101.86198708123689,
                      25.17921325044619
                    ],
                    [
                      -100,
                      25
                    ],
                    [
                      -100,
                      45
                    ],
                    [
                      -100.91771542987216,
                      45.11902264113142
                    ],
                    [
                      -101.83914820882129,
                      45.23066566095744
                    ],
                    [
                      -102.76408684381101,
                      45.334871148042566
                    ],
                    [
                      -103.69231278596531,
                      45.43158453478921
                    ],
                    [
                      -104.62360077694795,
                      45.520754727454865
                    ],
                    [
                      -105.55771922687842,
                      45.60233422982518
                    ],
                    [
                      -106.49443062262206,
                      45.676279259862476
                    ],
                    [
                      -107.43349196503112,
                      45.74254985867483
                    ],
                    [
                      -108.37465523345693,
                      45.80110999118176
                    ],
                    [
                      -109.3176678756072,
                      45.851927637889915
                    ],
                    [
                      -110.26227332058782,
                      45.89497487723585
                    ],
                    [
                      -111.20821151275038,
                      45.930227958001716
                    ],
                    [
                      -112.1552194637682,
                      45.957667361364436
                    ],
                    [
                      -113.10303182018596,
                      45.977277852197595
                    ],
                    [
                      -114.0513814435373,
                      45.98904851930915
                    ],
                    [
                      -114.99999999999999,
                      45.99297280436372
                    ],
                    [
                      -115.94861855646269,
                      45.98904851930916
                    ],
                    [
                      -116.89696817981404,
                      45.977277852197595
                    ],
                    [
                      -117.8447805362318,
                      45.957667361364436
                    ],
                    [
                      -118.79178848724958,
                      45.93022795800172
                    ],
                    [
                      -119.73772667941218,
                      45.89497487723586
                    ],
                    [
                      -120.68233212439277,
                      45.851927637889915
                    ],
                    [
                      -121.62534476654305,
                      45.80110999118176
                    ],
                    [
                      -122.56650803496886,
                      45.742549858674835
                    ],
                    [
                      -123.50556937737791,
                      45.67627925986248
                    ],
                    [
                      -124.44228077312155,
                      45.60233422982518
                    ],
                    [
                      -125.37639922305202,
                      45.520754727454865
                    ],
                    [
                      -126.30768721403466,
                      45.43158453478921
                    ],
                    [
                      -127.23591315618897,
                      45.33487114804259
                    ],
                    [
                      -128.16085179117871,
                      45.23066566095746
                    ],
                    [
                      -129.08228457012783,
                      45.11902264113142
                    ],
                    [
                      -130,
                      45
                    ],
                    [
                      -130,
                      25
                    ]
                  ]
                ]
              ]
            }
          }
        ])
      })
    })
  })
})
